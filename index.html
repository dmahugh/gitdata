<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="GitData: command-line tool for querying GitHub V3 API">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>GitData</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/dmahugh/gitdata">View on GitHub</a>

          <h1 id="project_title">GitData</h1>
          <h2 id="project_tagline">Command-line tool for querying GitHub V3 API</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/dmahugh/gitdata/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/dmahugh/gitdata/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

        <p>This page covers how to use the gitdata CLI (command-line interface). For installation instructions, source code, and other additional information, see the <a href="http://github.com/dmahugh/gitdata">gitdata GitHub repo</a>.</p>

        <h1>Overview</h1>
        <p>Gitdata is a tool that I built for my own use, to help automate some tasks I found myself doing over and over again.<p>
        <p>I work at Microsoft in the Open Source Programs Office, and we sometimes need to retrieve information about Microsoft's many GitHub repos, teams, and members. For example, we may want to create a report showing growth of public or private repos in one of Microsoft's GitHub orgs. Or we may need to audit an organization's members to determine who doesn't have two-factor authentication activated.</p>
        <p>I've written various one-off Python programs to handle these sorts of tasks, using the <a href="http://docs.python-requests.org/en/master/">Requests</a> library. After a while I decided it would be simpler to package up this functionality into a command-line tool, and gitdata is the result of that refactoring. I used Armin Ronacher's <a href="http://click.pocoo.org/5/">Click</a> package, which provides a simple decorator-based approach for exposing Python functions through a CLI.</p>
        <p>Gitdata's current functionality covers the specific types of queries that I've needed to date, including these features:</p>
        <ul>
          <li>get info about organizations, repos, teams, members, collaborators, commits</li>
          <li>output to the console and/or CSV/JSON files</li>
          <li>all data cached locally, can query live API or cache</li>
          <li>select fields, specify sorting order</li>
          <li>simple, consistent command-line syntax</li>
        </ul>

        <h1>Basic Concepts</h1>
        <p>The information in this section applies to all of the gitdata <i>subcommands</i>. There are currently five subcommands, as shown in the help screen:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/gitdata-help.png" align="center"/>

        <h3>Configuring Authentication</h3>
        <p>Gitdata uses personal access tokens (PATs) for authentication in GitHub API calls. You <i>can</i> use gitdata without authentication for simple requests, but some information (such as organization membership) is only available to authenticated users. And the GitHub API has a much lower rate limit for unauthenticated users &mdash; 60 calls per hour, instead of the 5000 calls per hour allowed for authenticated users.</p>
        <p>PATs are stored in a <code>github.ini</code> file in the <code>_private</code> subfolder under the parent folder of the location where gitdata is installed. To save a PAT for GitHub authentication in gitdata calls, use this command:</p>
        <p><pre>gitdata --auth=<i>username</i> --token=<i>PAT</i></pre></p>
        <p>After you've saved a PAT in this manner, you can specify the username in gitdata calls (via the <code>-a/--auth=</code> option) and gitdata will look up the PAT. To view a saved username/PAT, use this command:</p>
        <p><pre>gitdata --auth=<i>username</i></pre></p>
        <p>Only the first and last 2 characters of the PAT will be displayed &mdash; enough to help identify which PAT is in use, but not enough to accidentally disclose the PAT.</p>
        <p>To delete a saved PAT, use this command:</p>
        <p><pre>gitdata --auth=<i>username</i> --delete</pre></p>

        <h3>Quick Start</h3>
        <p>The fastest way to learn gitdata is to review the help screens and try some things. <b>Gitdata is read-only</b>, so you can experiment freely
        and the worst thing that could happen is to temporarily exhaust your GitHub API rate limit.</p>
        <p>Note that you can get help for specific subcommands. For example, to get help on how to retrieve repo information, use the command
        <code>gitdata repos -h</code>.</p>
        <p>In this simple example, we're retrieving the list of organizations for which GitHub user <b>dmahugh</b> is a member:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/quickstart01.png"/>
        <p>This example requires that a PAT for the dmahugh user has been configured, as covered in the <i>Configuring Authentication</i> section
        above. Here's what is being displayed in the output shown above:</p>
        <ul>
          <li><code>gitdata orgs -admahugh -v</code><br/>The <i>orgs</i> subcommand has been invoked, with <i>dmahugh</i> for the authentication username and with verbose mode on (<i>-v</i>). Note the use of shorthand notation, such as <code>-v</code> instead of <code>--verbose</code>. For options that require a value to be passed, you must use an <code>=</code> for the long version, but not for the short version. For example, <code>-fname</code> is equivalent to <code>--fields=name</code>.</li>
          <li><code>Cached data found ...</code><br/>there is locally cached data available, so by default the user is prompted for which data source to use; we asked for API data (<i>a</i>) in this example</li>
          <li><code>Endpoint ... / Rate Limit ... / Status ...</code><br/>this information is being displayed because we asked for <i>verbose mode</i></li>
          <li><code>Cache update ...</code><br/>this shows that the local cached data file for this username/endpoint has been updated to include the latest data returned by the GitHub API</li>
          <li><code>dotnet,dmahugh ...</code><br/>these four lines show a summary of the returned data; you can turn off this console display with the <i>-d/--display</i> option, and/or you can customize the fields displayed with the <i>-f/--fields</i> option</li>
          <li><code>Elapsed time ...</code><br/>this information is displayed because we're in <i>verbose mode</i></li>
        </ul>
        <p>Here's another example, showing the explicit use of the cached data source (<b>-sc</b>):</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/quickstart02.png"/>
        <p>As you can see, use of the cached data provides very fast performance.</p>

        <h3>Fields and Sorting</h3>
        <p>All fields returned by the GitHub API are saved in gitdata's local cache, but only specified fields are included in console output and/or CSV and JSON output files. If you don't specify any fields, a set of <i>default fields</i> are returned for each entity type (collabs, commits, members, orgs, repos, teams).</p>
        <p>To specify a custom set of fields, use the <code>-f/--fields</code> option and specify the field names as a /-delimited string. For example:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/customfields.png"/>
        <p>To determine which field names are available for an entity type, use the <code>-l/--listfields</code> option. For example, here are the fields that can be specified for the <code>members</code> subcommand:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/listfields.png"/>
        <p>Shorthand notation can be used for all fields (*), or only the url or non-url fields. GitHub APIs return many URLs, which can be useful when building a user interface. If you're just doing data analysis and reporting, the <code>nourls</code> option can make data payloads up to 90% smaller.</p>
        <p>For example, here is the full JSON payload returned for a member of an organization when using the <code>members</code> subcommand:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/minimize-before.png"/>
        <p>And here's the data returned when using the <code>--fields=nourls</code> option for the same member:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/minimize-after.png"/>

        <p>NOTE: gitdata sorts all output by the <i>first</i> field specified.</p>

        <h3>Saving Output</h3>
        <p>Gitdata supports saving data in CSV or JSON format. Use the <code>-n/--filename</code> option to specify a filename for saving output (and note that the filename must end in <i>.csv</i> or <i>.json</i>.) Here's an example of saving to a CSV file and then opening that file in Excel:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/output-csv.png"/>

        <h3>Cached Data</h3>
        <p>By default, gitdata caches all data retrieved from the GitHub API. (This behavior can be changed.)</p>
        <p><i>All</i> data
        is cached, not just the requested fields. For example, you can request repo names and descriptions for a large organization's
        repos, and then if you want to add license type to the results you can query the cached data to get the license type field.</p>
        <p>Here's an example of retrieving the repos for user octocat, without authentication:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/cache01.png"/>
        <p>A cache file was created automatically by the above command. If you query the same data type under the same authentication
        username and same selection criteria, gitdata gives you the option of using the cached data:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/cache02.png"/>
        <p>Note: if you had chosen to read from the API instead, the cache would have been automatically updated with the more recent data.</p>
        <p><i>All</i> fields are saved in gitdata's local cache, which means you can do a query from the cache that includes different fields from the ones in your original query of the API. For example:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/cachedfields.png"/>
        <p>Each combination of authentication username, selection criteria, and data type is stored in a unique filename in the
        <b>gh_cache</b> folder. The filename describes the data:</p>
        <ul>
          <li>Authentication username (_anon = anonymous)</li>
          <li>Selection criteria (e.g., users-octocat)</li>
          <li>Type of information (e.g., repos)</li>
        </ul>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/cache03.png"/>
        <p>The above information is provided here for those who want to know how gitdata's caching is implemented, but you don't
        need to know any of these details to use gitdata. Just type your query, and if you're presented with an option to use
        cached data you can either select either data source: the cache (for fastest results), or the API (for most current results).</p>

        <h3>GitHub API Pagination</h3>
        <p>Many of the GitHub API endpoints return <i>pages</i> of results rather than complete data sets, with links to previous/next
        page provided in the response header. Gitdata hides this structure, and always returns complete data sets. If you're curious about
        how this is implemented, see the <code>github_data_from_api()</code> and <code>pagination()</code> functions.</p>

        <h3>Verbose mode</h3>
        <p>The <b>-v/--verbose</b> flag enables <i>verbose mode</i>, causing a variety of information to be displayed on the console, including:</p>
        <ul>
          <li>API endpoints accessed</li>
          <li>HTTP status codes returned, and number of bytes returned</li>
          <li>API rate-limit status after each API call</li>
          <li>cache files read or written</li>
        </ul>
        <p>For diagnosing problems, it can be useful to suppress the default console output and only view the verbose-mode information
        returned. To do this, use the <b>-d</b> option to suppress the displayed output, in combination with the <b>-v</b> option to
        enable verbose mode.</p>
        <p>Here's an example of retrieving all Microsoft repos with this approach; note the first endpoint is the API
        endpoint for repo information, then gitdata is stepping through the pagination endpoints for this set of data:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/verbosemode.png"/>

        <h1>Entity Types</h1>
        <p>Gitdata supports various <i>subcommands</i> that correspond to specific <i>entities</i> (data types) that are returned by the GitHub API. Each entity may have unique options for criteria that must be provided to identify the desired information, and that information is covered below under each entity type.</p>
        
        <p>The following options are common to all entities and were documented above, so these are <i>not</i> covered under each entity below:</p>
        <img src="https://raw.githubusercontent.com/dmahugh/gitdata/master/images/options-common.png"/>

        <h3>Collaborators</h3>
        <p>The <code>collabs</code> subcommand supports two selection criteria:</p>
        <ul>
          <li><code>-o/--owner</code> owner of the repo (org or user) &mdash; <i>required</i></li>
          <li><code>-r/--repo</code> repository name &mdash; <i>required</i></li>
        </ul>
        <p>These two criteria uniquely identify a repo, and the collaborators for that repo will be returned.</p>

        <h3>Commits</h3>
        <p>The <code>commits</code> subcommand supports /// criteria:</p>

        <h3>Members</h3>
        <p>The <code>members</code> subcommand supports two selection criteria: <i>org</i> and <i>team ID</i>.</p>
        <ul>
          <li><code>-o/--org</code> organization name</li>
          <li><code>-t/--teamid</code> team ID (the numeric ID, not the team name)</li>
        </ul>
        <p>You must provide one of these criteria, and the members of that org or team will be returned. Note that you can get team IDs for the teams in an organization via the <code>teams</code> subcommand if needed.</p>

        <p>The <i>members</i> subcommand also supports two command-line options that may be useful for membership governance tasks: <code>--audit2fa</code> and <code>--adminonly</code>. The <code>--audit2fa</code> option returns only the members that <i>do not</i> have two-factor authentication enabled. The <code>--adminonly</code> option returns all members that have <i>role=admin</i>.</p>

        <h3>Organizations</h3>
        <p>The <code>orgs</code> subcommand does not support or require any selection criteria, but (unlike the other subcommands) it <i>requires</i> that an authentication username (with associated PAT) be used. The returned list of organizations contains the organizations for which this GitHub user is a member.</p>

        <h3>Repositories</h3>
        <p>The <code>repos</code> subcommand requires that you specify the owner of the repositories. The owner can be either an <i>organization</i> (specified by the <code>-o/--org</code> option) or a <i>user</i> (specified by the <code>-u/--user</code> option).</p>
        <p>When an organization is specified for the owner, this subcommand will return all public repos in that organization, and will also include all private repos <i>if you are authenticating under a GitHub user who has access to those private repos</i>.</p>
        <p>When a user is specified for the owner, <i>only public repos</i> are returned. This is a limitation of the <code>/users/:user/repos</code> endpoint used in this case &mdash; that endpoint does not return private repos, even if you are authenticated under the same username as specified in the endpoint. This may be addressed in a future update, by using a different GitHub API endpoint in that particular case.<p>

        <h3>Teams</h3>
        <p>The <code>teams</code> subcommand requires that an organization be specified via the <code>-o/--rg</code> option. All teams in that organization will be returned.</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">GitData maintained by <a href="https://github.com/dmahugh">dmahugh</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
